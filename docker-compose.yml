services:
  api:
    build:
      context: .
      dockerfile: IncidentCommander.API/Dockerfile
    ports:
      - "5294:5294"
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT:-Development}
      - ConnectionStrings__DefaultConnection=${DB_CONNECTION_STRING}
    extra_hosts:
      - "host.docker.internal:host-gateway"

  mcp:
    build:
      context: ./IncidentCommander.MCP
    environment:
      - API_BASE_URL=http://api:5294
    depends_on:
      - api

  inspector:
    build:
      context: ./IncidentCommander.MCP
      dockerfile: Dockerfile.inspector
    ports:
      - "6274:6274"
      - "6277:6277"
    environment:
      - API_BASE_URL=http://api:5294
      - HOST=0.0.0.0
      - PYTHONUNBUFFERED=1
      - DEBUG=mcp:*
    depends_on:
      - mcp
    extra_hosts:
      - "host.docker.internal:host-gateway"
